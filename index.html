<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì˜¤ëŠ˜ì˜ ì‹œí™© ë¸Œë¦¬í•‘</title>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0d0f14;
      --surface:#161b24;
      --surface2:#1e2535;
      --border:rgba(255,255,255,0.07);
      --text:#f0f2f7;
      --muted:#8b93a8;
      --up:#ff5b5b;
      --down:#4c8ef7;
      --accent:#6366f1;
      --gold:#f59e0b;
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{
      background:var(--bg);
      color:var(--text);
      font-family:'Pretendard', -apple-system, sans-serif;
      padding-bottom:92px;
    }

    .wrap{max-width:480px;margin:0 auto;padding:0 16px;}
    header{padding:26px 0 16px;}
    .header-date{font-size:12px;color:var(--muted);letter-spacing:.08em;text-transform:uppercase;margin-bottom:6px;}
    .header-title{font-size:24px;font-weight:800;letter-spacing:-.03em;}
    .header-title span{
      background:linear-gradient(135deg,#6366f1,#a78bfa);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .header-sub{font-size:13px;color:var(--muted);margin-top:6px;}

    /* page switch */
    .pages{position:relative;}
    .page{
      display:none;
      opacity:0;
      transform:translateY(8px);
      transition:opacity .18s ease, transform .18s ease;
      padding-bottom:10px;
    }
    .page.active{
      display:block;
      opacity:1;
      transform:translateY(0);
    }

    /* skeleton */
    .skeleton{
      background:linear-gradient(90deg,var(--surface) 25%,var(--surface2) 50%,var(--surface) 75%);
      background-size:200% 100%;
      animation:shimmer 1.5s infinite;
      border-radius:8px;
    }
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    /* summary */
    .summary-card{
      background:linear-gradient(135deg,#1a1d35,#1e2535);
      border:1px solid rgba(99,102,241,0.25);
      border-radius:20px;
      padding:18px;
      margin-bottom:18px;
      position:relative;
      overflow:hidden;
    }
    .summary-card::before{
      content:'';
      position:absolute;top:-30px;right:-30px;
      width:100px;height:100px;
      background:radial-gradient(circle,rgba(99,102,241,0.12),transparent 70%);
    }
    .summary-label{
      display:flex;align-items:center;gap:6px;
      font-size:11px;font-weight:700;color:#818cf8;
      letter-spacing:.08em;text-transform:uppercase;margin-bottom:10px;
    }
    .ai-dot{width:6px;height:6px;background:#6366f1;border-radius:50%;animation:pulse 2s infinite;}
    @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.5;transform:scale(.8)}}
    .summary-text{font-size:13px;line-height:1.75;color:#c7d2fe;}
    .summary-text strong{color:#fff;font-weight:600;}

    /* sections */
    .section-header{display:flex;align-items:center;justify-content:space-between;margin:14px 0 10px;}
    .section-title{
      font-size:12px;font-weight:700;color:var(--muted);
      letter-spacing:.06em;text-transform:uppercase;
      display:flex;align-items:center;gap:8px;
    }
    .section-title::before{content:'';width:3px;height:12px;background:var(--accent);border-radius:2px;}
    .refresh-btn{
      font-size:11px;color:var(--muted);cursor:pointer;
      background:none;border:none;display:flex;align-items:center;gap:4px;
      padding:6px 10px;border-radius:10px;transition:background .15s;
    }
    .refresh-btn:hover{background:var(--surface2);color:var(--text);}
    .spin{animation:spin 1s linear infinite;}
    @keyframes spin{to{transform:rotate(360deg)}}

    /* grid cards */
    .index-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:14px;}
    .index-card{
      background:var(--surface);border:1px solid var(--border);
      border-radius:16px;padding:16px;transition:all .2s;
    }
    .index-card:hover{background:var(--surface2);transform:translateY(-1px);}
    .index-name{font-size:11px;color:var(--muted);font-weight:500;margin-bottom:6px;}
    .index-value{font-size:19px;font-weight:700;letter-spacing:-.02em;margin-bottom:3px;}
    .index-change{font-size:12px;font-weight:600;display:flex;align-items:center;gap:3px;}
    .up{color:var(--up);}
    .down{color:var(--down);}
    .neutral-c{color:var(--muted);}
    .mini-chart{margin-top:10px;height:30px;width:100%;}

    .fx-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:14px;}
    .fx-card{
      background:var(--surface);border:1px solid var(--border);
      border-radius:14px;padding:14px 10px;text-align:center;
    }
    .fx-label{font-size:10px;color:var(--muted);margin-bottom:5px;font-weight:600;letter-spacing:.05em;text-transform:uppercase;}
    .fx-value{font-size:15px;font-weight:700;letter-spacing:-.01em;margin-bottom:3px;}
    .fx-change{font-size:11px;font-weight:600;}

    .re-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:14px;}
    .re-card{
      background:var(--surface);border:1px solid var(--border);
      border-radius:14px;padding:14px 10px;text-align:center;
    }
    .re-region{font-size:11px;color:var(--muted);margin-bottom:5px;}
    .re-value{font-size:15px;font-weight:700;letter-spacing:-.02em;margin-bottom:3px;}
    .re-sub{font-size:11px;font-weight:600;}

    .stock-list{
      background:var(--surface);border:1px solid var(--border);
      border-radius:20px;overflow:hidden;margin-bottom:14px;
    }
    .stock-item{
      display:flex;align-items:center;padding:13px 16px;
      border-bottom:1px solid var(--border);transition:background .15s;
    }
    .stock-item:last-child{border-bottom:none;}
    .stock-item:hover{background:var(--surface2);}
    .stock-rank{font-size:12px;color:var(--muted);font-weight:600;width:18px;flex-shrink:0;}
    .stock-icon{
      width:34px;height:34px;border-radius:10px;
      display:flex;align-items:center;justify-content:center;
      font-size:12px;font-weight:800;margin:0 10px 0 8px;flex-shrink:0;
    }
    .stock-info{flex:1;}
    .stock-name{font-size:13px;font-weight:600;margin-bottom:1px;}
    .stock-ticker{font-size:11px;color:var(--muted);}
    .stock-price-wrap{text-align:right;}
    .stock-price{font-size:14px;font-weight:700;margin-bottom:2px;}
    .stock-change{font-size:11px;font-weight:600;}

    .news-list{display:flex;flex-direction:column;gap:8px;margin-bottom:14px;}
    .news-item{
      background:var(--surface);border:1px solid var(--border);
      border-radius:14px;padding:13px 14px;
      display:flex;align-items:flex-start;gap:10px;
      transition:background .15s;
    }
    .news-item:hover{background:var(--surface2);}
    .news-tag{
      font-size:10px;font-weight:700;padding:3px 7px;
      border-radius:20px;white-space:nowrap;flex-shrink:0;margin-top:1px;
    }
    .tag-red{background:rgba(255,91,91,0.15);color:var(--up);}
    .tag-blue{background:rgba(76,142,247,0.15);color:var(--down);}
    .tag-gold{background:rgba(245,158,11,0.15);color:var(--gold);}
    .tag-purple{background:rgba(99,102,241,0.15);color:#818cf8;}
    .news-text{font-size:13px;line-height:1.5;color:#d1d5e8;}
    .news-time{font-size:11px;color:var(--muted);margin-top:3px;}

    .last-updated{
      text-align:center;
      font-size:11px;
      color:var(--muted);
      margin:10px 0 6px;
    }

    /* settings */
    .panel{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:18px;
      padding:16px;
      margin-bottom:12px;
    }
    .panel-title{font-size:12px;color:var(--muted);font-weight:700;letter-spacing:.06em;text-transform:uppercase;margin-bottom:10px;}
    .row{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;padding:10px 0;border-top:1px solid var(--border);
    }
    .row:first-of-type{border-top:none;}
    .row-left{min-width:0;}
    .row-name{font-size:13px;font-weight:700;}
    .row-desc{font-size:11px;color:var(--muted);margin-top:3px;line-height:1.4;}
    .btn{
      background:var(--surface2);
      border:1px solid var(--border);
      color:var(--text);
      padding:8px 10px;
      border-radius:12px;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
    }
    .btn:hover{border-color:rgba(99,102,241,0.35);}
    .toggle{
      width:46px;height:26px;border-radius:999px;
      background:rgba(255,255,255,0.10);
      border:1px solid var(--border);
      position:relative;cursor:pointer;flex-shrink:0;
    }
    .toggle::after{
      content:'';
      position:absolute;top:3px;left:3px;
      width:20px;height:20px;border-radius:999px;
      background:#cbd5e1;
      transition:transform .18s ease, background .18s ease;
    }
    .toggle.on{background:rgba(99,102,241,0.18);border-color:rgba(99,102,241,0.35);}
    .toggle.on::after{transform:translateX(20px);background:#818cf8;}

    /* toast */
    .toast{
      position:fixed;bottom:98px;left:50%;transform:translateX(-50%);
      background:#1e2535;border:1px solid rgba(255,91,91,0.4);
      color:#ffb3b3;font-size:12px;padding:10px 16px;border-radius:12px;
      z-index:999;opacity:0;transition:opacity .25s;pointer-events:none;
      white-space:nowrap;
    }
    .toast.show{opacity:1;}

    /* bottom nav */
    .bottom-nav{
      position:fixed;bottom:0;left:0;right:0;
      background:rgba(13,15,20,0.96);
      backdrop-filter:blur(20px);
      border-top:1px solid var(--border);
      display:flex;justify-content:space-around;
      padding:10px 0 18px;
      z-index:100;
    }
    .nav-item{
      display:flex;flex-direction:column;align-items:center;gap:3px;
      cursor:pointer;
      opacity:0.42;
      transition:opacity .18s ease, transform .18s ease;
      user-select:none;
    }
    .nav-item.active{
      opacity:1;
      transform:translateY(-1px);
    }
    .nav-icon{font-size:19px;}
    .nav-label{font-size:10px;font-weight:700;}
    .nav-item.active .nav-label{color:#818cf8;}
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="header-date" id="todayDate"></div>
      <h1 class="header-title"><span id="pageTitle">ì‹œí™©</span> ë¸Œë¦¬í•‘</h1>
      <p class="header-sub" id="headerSub">ì‹¤ì‹œê°„ ë°ì´í„°(Alpha Vantage) Â· ì˜¤ë¥˜/í•œë„ ì´ˆê³¼ ì‹œ ë°ëª¨ë¡œ ìë™ ì „í™˜</p>
    </header>

    <div class="pages">
      <!-- PAGE: ì‹œí™© -->
      <section class="page active" data-page="market">
        <div class="summary-card">
          <div class="summary-label"><div class="ai-dot"></div>AI ë¸Œë¦¬í•‘ ìš”ì•½</div>
          <p class="summary-text" id="summaryText">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì´ì—ìš”...</p>
        </div>

        <div class="section-header">
          <div class="section-title">ë¯¸êµ­ ì§€ìˆ˜</div>
          <button class="refresh-btn" onclick="loadMarketData()"><span id="refreshIcon">â†»</span> ìƒˆë¡œê³ ì¹¨</button>
        </div>
        <div class="index-row" id="usIndexRow">
          <div class="index-card">
            <div class="index-name">ë‚˜ìŠ¤ë‹¥</div>
            <div class="index-value skeleton" style="height:28px;width:100px;margin-bottom:6px"></div>
            <div class="skeleton" style="height:16px;width:120px"></div>
            <div class="skeleton" style="height:30px;margin-top:10px;border-radius:6px"></div>
          </div>
          <div class="index-card">
            <div class="index-name">S&amp;P 500</div>
            <div class="index-value skeleton" style="height:28px;width:100px;margin-bottom:6px"></div>
            <div class="skeleton" style="height:16px;width:120px"></div>
            <div class="skeleton" style="height:30px;margin-top:10px;border-radius:6px"></div>
          </div>
        </div>

        <div class="section-header"><div class="section-title">êµ­ë‚´ ì§€ìˆ˜</div></div>
        <div class="index-row" id="krIndexRow">
          <div class="index-card">
            <div class="index-name">KOSPI</div>
            <div class="index-value skeleton" style="height:28px;width:100px;margin-bottom:6px"></div>
            <div class="skeleton" style="height:16px;width:120px"></div>
            <div class="skeleton" style="height:30px;margin-top:10px;border-radius:6px"></div>
          </div>
          <div class="index-card">
            <div class="index-name">KOSDAQ</div>
            <div class="index-value skeleton" style="height:28px;width:100px;margin-bottom:6px"></div>
            <div class="skeleton" style="height:16px;width:120px"></div>
            <div class="skeleton" style="height:30px;margin-top:10px;border-radius:6px"></div>
          </div>
        </div>

        <div class="last-updated" id="lastUpdated_market"></div>
      </section>

      <!-- PAGE: ë¶€ë™ì‚° -->
      <section class="page" data-page="realestate">
        <div class="section-header">
          <div class="section-title">ë¶€ë™ì‚° ì‹œí™©</div>
          <span style="font-size:11px;color:var(--muted)">KBë¶€ë™ì‚° ê¸°ì¤€(í˜„ì¬ ë°ëª¨)</span>
        </div>
        <div class="re-grid" id="reGrid"></div>

        <div class="panel">
          <div class="panel-title">ë©”ëª¨</div>
          <div style="font-size:13px;line-height:1.65;color:#d1d5e8">
            ì§€ê¸ˆì€ ë¶€ë™ì‚°ì€ ë°ëª¨ ê°’ì´ì—ìš”. ë‹¤ìŒ ë‹¨ê³„ì—ì„œ KB/êµ­í† ë¶€/ì•„íŒŒíŠ¸ë¯¸ ë“± ë°ì´í„° ì†ŒìŠ¤ë¡œ ë¶™ì´ë©´ â€œì‹¤ì‹œê°„â€ì²˜ëŸ¼ ë§Œë“¤ ìˆ˜ ìˆì–´ìš”.
          </div>
        </div>

        <div class="last-updated" id="lastUpdated_realestate"></div>
      </section>

      <!-- PAGE: ì£¼ì‹ -->
      <section class="page" data-page="stocks">
        <div class="section-header"><div class="section-title">ì£¼ëª© ì¢…ëª©</div></div>
        <div class="stock-list" id="stockList"></div>

        <div class="section-header"><div class="section-title">ì£¼ìš” ë‰´ìŠ¤</div></div>
        <div class="news-list" id="newsList"></div>

        <div class="last-updated" id="lastUpdated_stocks"></div>
      </section>

      <!-- PAGE: í™˜ìœ¨ -->
      <section class="page" data-page="fx">
        <div class="section-header"><div class="section-title">í™˜ìœ¨ Â· ê¸ˆë¦¬</div></div>
        <div class="fx-row" id="fxRow"></div>

        <div class="panel">
          <div class="panel-title">ì„¤ëª…</div>
          <div style="font-size:13px;line-height:1.65;color:#d1d5e8">
            USD/KRWëŠ” Alpha Vantageë¡œ ì‹¤ì‹œê°„ í˜¸ì¶œí•©ë‹ˆë‹¤. (ë¬´ë£Œí‚¤ëŠ” í˜¸ì¶œ ì œí•œì´ ìˆì–´ í•œë„ ì´ˆê³¼ ì‹œ ìë™ìœ¼ë¡œ ë°ëª¨ë¡œ í´ë°±ë©ë‹ˆë‹¤.)
          </div>
        </div>

        <div class="last-updated" id="lastUpdated_fx"></div>
      </section>

      <!-- PAGE: ì„¤ì • -->
      <section class="page" data-page="settings">
        <div class="panel">
          <div class="panel-title">ë°ì´í„°</div>

          <div class="row">
            <div class="row-left">
              <div class="row-name">ìë™ ê°±ì‹ </div>
              <div class="row-desc">5ë¶„ë§ˆë‹¤ ìë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.</div>
            </div>
            <div class="toggle on" id="autoToggle" onclick="toggleAutoRefresh()"></div>
          </div>

          <div class="row">
            <div class="row-left">
              <div class="row-name">ì¦‰ì‹œ ìƒˆë¡œê³ ì¹¨</div>
              <div class="row-desc">ì§€ê¸ˆ ë°”ë¡œ ë°ì´í„°ë¥¼ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.</div>
            </div>
            <button class="btn" onclick="loadMarketData(true)">ìƒˆë¡œê³ ì¹¨</button>
          </div>

          <div class="row">
            <div class="row-left">
              <div class="row-name">API ìƒíƒœ</div>
              <div class="row-desc" id="apiStatusText">í™•ì¸ ì¤‘â€¦</div>
            </div>
            <button class="btn" onclick="showKey()">í‚¤ ë³´ê¸°</button>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">UI</div>
          <div class="row">
            <div class="row-left">
              <div class="row-name">íƒ­ ì• ë‹ˆë©”ì´ì…˜</div>
              <div class="row-desc">í™”ë©´ ì „í™˜ì„ ë¶€ë“œëŸ½ê²Œ ë³´ì—¬ì¤ë‹ˆë‹¤.</div>
            </div>
            <div class="toggle on" id="animToggle" onclick="toggleAnim()"></div>
          </div>
        </div>

        <div class="last-updated" id="lastUpdated_settings"></div>
      </section>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <nav class="bottom-nav">
    <div class="nav-item active" data-target="market">
      <div class="nav-icon">ğŸ“Š</div><div class="nav-label">ì‹œí™©</div>
    </div>
    <div class="nav-item" data-target="realestate">
      <div class="nav-icon">ğŸ </div><div class="nav-label">ë¶€ë™ì‚°</div>
    </div>
    <div class="nav-item" data-target="stocks">
      <div class="nav-icon">ğŸ“ˆ</div><div class="nav-label">ì£¼ì‹</div>
    </div>
    <div class="nav-item" data-target="fx">
      <div class="nav-icon">ğŸ’±</div><div class="nav-label">í™˜ìœ¨</div>
    </div>
    <div class="nav-item" data-target="settings">
      <div class="nav-icon">âš™ï¸</div><div class="nav-label">ì„¤ì •</div>
    </div>
  </nav>

  <script>
    // ===============================
    // Alpha Vantage API Key (í˜•ë‹˜ ì œê³µ)
    // ===============================
    const API_KEY = '96Q38KWBQJHU0Z10';
    const isLive = true;

    // settings states
    let autoRefreshEnabled = true;
    let pageAnimEnabled = true;
    let autoTimer = null;

    // â”€â”€â”€ ë‚ ì§œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const now = new Date();
    const DAYS = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
    document.getElementById('todayDate').textContent =
      `${now.getFullYear()}ë…„ ${now.getMonth()+1}ì›” ${now.getDate()}ì¼ (${DAYS[now.getDay()]})`;

    // â”€â”€â”€ toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showToast(msg, duration = 3000) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), duration);
    }

    // â”€â”€â”€ íƒ­ ì „í™˜(B: í™”ë©´ ê°ˆì•„ë¼ìš°ê¸°) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const TITLE_MAP = {
      market: 'ì‹œí™©',
      realestate: 'ë¶€ë™ì‚°',
      stocks: 'ì£¼ì‹',
      fx: 'í™˜ìœ¨',
      settings: 'ì„¤ì •',
    };

    function setPage(pageName) {
      const pages = document.querySelectorAll('.page');
      pages.forEach(p => {
        if (p.dataset.page === pageName) p.classList.add('active');
        else p.classList.remove('active');
      });

      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(n => {
        if (n.dataset.target === pageName) n.classList.add('active');
        else n.classList.remove('active');
      });

      document.getElementById('pageTitle').textContent = TITLE_MAP[pageName] || 'ì‹œí™©';

      // animation toggle
      if (!pageAnimEnabled) {
        pages.forEach(p => { p.style.transition = 'none'; });
        requestAnimationFrame(() => pages.forEach(p => { p.style.transition = ''; }));
      }
    }

    document.querySelectorAll('.nav-item').forEach(el => {
      el.addEventListener('click', () => setPage(el.dataset.target));
    });

    // â”€â”€â”€ settings toggles â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleAutoRefresh() {
      autoRefreshEnabled = !autoRefreshEnabled;
      document.getElementById('autoToggle').classList.toggle('on', autoRefreshEnabled);
      if (autoRefreshEnabled) startAutoRefresh();
      else stopAutoRefresh();
      showToast(autoRefreshEnabled ? 'âœ… ìë™ ê°±ì‹  ON' : 'â¸ ìë™ ê°±ì‹  OFF', 1800);
    }

    function toggleAnim() {
      pageAnimEnabled = !pageAnimEnabled;
      document.getElementById('animToggle').classList.toggle('on', pageAnimEnabled);
      showToast(pageAnimEnabled ? 'âœ… ì• ë‹ˆë©”ì´ì…˜ ON' : 'ğŸ§Š ì• ë‹ˆë©”ì´ì…˜ OFF', 1800);
    }

    function showKey() {
      showToast(`API KEY: ${API_KEY}`, 3000);
    }

    // â”€â”€â”€ mini chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function miniChart(points, isUp) {
      const color = isUp ? '#ff5b5b' : '#4c8ef7';
      const gradId = 'g' + Math.random().toString(36).substr(2,5);
      const min = Math.min(...points), max = Math.max(...points);
      const range = max - min || 1;
      const w = 100, h = 30;
      const pts = points.map((v, i) => {
        const x = (i / (points.length - 1)) * w;
        const y = h - ((v - min) / range) * (h - 4) - 2;
        return `${x},${y}`;
      }).join(' ');
      return `<svg class="mini-chart" viewBox="0 0 100 30" preserveAspectRatio="none">
        <defs><linearGradient id="${gradId}" x1="0" y1="0" x2="0" y2="1">
          <stop offset="0%" stop-color="${color}" stop-opacity="0.2"/>
          <stop offset="100%" stop-color="${color}" stop-opacity="0"/>
        </linearGradient></defs>
        <polyline points="${pts}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        <polyline points="${pts} 100,30 0,30" fill="url(#${gradId})" stroke="none"/>
      </svg>`;
    }

    function randomPoints(base, volatility, count = 12, trend = 0) {
      const pts = [base];
      for (let i = 1; i < count; i++) {
        const prev = pts[i-1];
        const change = (Math.random() - 0.48) * volatility + trend;
        pts.push(Math.max(prev + change, base * 0.9));
      }
      return pts;
    }

    // â”€â”€â”€ DEMO (í´ë°±) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const DEMO_DATA = {
      nasdaq: { value: '17,845.12', change: '-124.56', pct: '-0.69', up: false },
      sp500:  { value: '5,012.34',  change: '+18.90',  pct: '+0.38', up: true  },
      kospi:  { value: '2,631.46',  change: '+12.34',  pct: '+0.47', up: true  },
      kosdaq: { value: '851.24',    change: '-3.21',   pct: '-0.38', up: false },
      fx: { usd: '1,342', rate: '3.50%', bond: '3.28%',
            usdChg: '-3.2ì›', rateChg: 'ë™ê²°', bondChg: 'â–² 0.02%p',
            usdUp: true, rateUp: false, bondUp: true },
      stocks: [
        { rank:1, name:'ì‚¼ì„±ì „ì', ticker:'005930', icon:'ì‚¼', color:'#ff5b5b', price:'74,800ì›', change:'+800 (+1.08%)', up:true },
        { rank:2, name:'SKí•˜ì´ë‹‰ìŠ¤', ticker:'000660', icon:'SK', color:'#4c8ef7', price:'198,500ì›', change:'-1,500 (-0.75%)', up:false },
        { rank:3, name:'NVIDIA', ticker:'NVDA', icon:'NV', color:'#f59e0b', price:'$875.40', change:'+12.30 (+1.42%)', up:true },
        { rank:4, name:'Apple', ticker:'AAPL', icon:'ğŸ', color:'#818cf8', price:'$182.40', change:'-2.10 (-1.14%)', up:false },
      ],
      news: [
        { tag:'ì£¼ì‹', tagClass:'tag-blue', text:'ì‹¤ì‹œê°„ ë‰´ìŠ¤ ì—°ë™ ì „(ë°ëª¨)', time:'â€”' },
        { tag:'ë¶€ë™ì‚°', tagClass:'tag-red', text:'ì‹¤ì‹œê°„ ë¶€ë™ì‚° ì§€í‘œ ì—°ë™ ì „(ë°ëª¨)', time:'â€”' },
        { tag:'í™˜ìœ¨', tagClass:'tag-gold', text:'USD/KRWëŠ” ì‹¤ì‹œê°„, ë‚˜ë¨¸ì§€ëŠ” ë°ëª¨', time:'â€”' },
        { tag:'ë°˜ë„ì²´', tagClass:'tag-purple', text:'ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ë‰´ìŠ¤/ì¢…ëª© ì‹¤ì‹œê°„ ì—°ë™ ê°€ëŠ¥', time:'â€”' },
      ],
      re: [
        { region:'ì„œìš¸', value:'+0.02%', sub:'ë§¤ë§¤ ë³´í•©', up:true },
        { region:'ê²½ê¸°', value:'-0.03%', sub:'ì†Œí­ í•˜ë½', up:false },
        { region:'ì¸ì²œ', value:'-0.01%', sub:'ë³´í•©', up:false },
        { region:'ë¶€ì‚°', value:'+0.04%', sub:'ì†Œí­ ìƒìŠ¹', up:true },
        { region:'ì „ì„¸', value:'+0.01%', sub:'ì„œìš¸ ê¸°ì¤€', up:true },
        { region:'ê±°ë˜ëŸ‰', value:'2,341ê±´', sub:'ì „ì£¼æ¯” â†‘12%', up:true },
      ],
      summary: `í˜„ì¬ <strong>ì‹¤ì‹œê°„ API í˜¸ì¶œì— ì‹¤íŒ¨</strong>í•´ ë°ëª¨ë¡œ í‘œì‹œ ì¤‘ì…ë‹ˆë‹¤. (Alpha Vantage í•œë„/ì˜¤ë¥˜ ê°€ëŠ¥)<br/>ì ì‹œ í›„ ìƒˆë¡œê³ ì¹¨ì„ ëˆŒëŸ¬ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.`
    };

    // â”€â”€â”€ Alpha Vantage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function fetchQuote(symbol) {
      const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${encodeURIComponent(symbol)}&apikey=${encodeURIComponent(API_KEY)}`;
      const res = await fetch(url);
      const data = await res.json();
      const q = data['Global Quote'];
      if (!q || !q['05. price']) {
        const msg = data?.Note || data?.Information || 'ë°ì´í„° ì—†ìŒ';
        throw new Error(`QUOTE ì˜¤ë¥˜(${symbol}): ${msg}`);
      }
      return {
        price: parseFloat(q['05. price']),
        change: parseFloat(q['09. change']),
        pct: parseFloat(String(q['10. change percent']).replace('%','')),
      };
    }

    async function fetchFX() {
      const url = `https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=USD&to_currency=KRW&apikey=${encodeURIComponent(API_KEY)}`;
      const res = await fetch(url);
      const data = await res.json();
      const rate = data['Realtime Currency Exchange Rate'];
      if (!rate) {
        const msg = data?.Note || data?.Information || 'í™˜ìœ¨ ë°ì´í„° ì—†ìŒ';
        throw new Error(`FX ì˜¤ë¥˜: ${msg}`);
      }
      return parseFloat(rate['5. Exchange Rate']);
    }

    // â”€â”€â”€ render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderIndexCard(name, d, chartPts) {
      const arrow = d.up ? 'â–²' : 'â–¼';
      const cls = d.up ? 'up' : 'down';
      return `<div class="index-card">
        <div class="index-name">${name}</div>
        <div class="index-value">${d.value}</div>
        <div class="index-change ${cls}">${arrow} ${d.change} (${d.pct}%)</div>
        ${miniChart(chartPts, d.up)}
      </div>`;
    }

    function renderFX(d) {
      return `
        <div class="fx-card">
          <div class="fx-label">USD/KRW</div>
          <div class="fx-value">${d.usd}</div>
          <div class="fx-change ${d.usdUp ? 'down' : 'up'}">${d.usdChg}</div>
        </div>
        <div class="fx-card">
          <div class="fx-label">ê¸°ì¤€ê¸ˆë¦¬</div>
          <div class="fx-value">${d.rate}</div>
          <div class="fx-change neutral-c">${d.rateChg}</div>
        </div>
        <div class="fx-card">
          <div class="fx-label">êµ­ê³ ì±„ 3Y</div>
          <div class="fx-value">${d.bond}</div>
          <div class="fx-change ${d.bondUp ? 'up' : 'down'}">${d.bondChg}</div>
        </div>`;
    }

    function renderStocks(stocks) {
      return stocks.map(s => `
        <div class="stock-item">
          <div class="stock-rank">${s.rank}</div>
          <div class="stock-icon" style="background:${s.color}22;color:${s.color}">${s.icon}</div>
          <div class="stock-info">
            <div class="stock-name">${s.name}</div>
            <div class="stock-ticker">${s.ticker}</div>
          </div>
          <div class="stock-price-wrap">
            <div class="stock-price">${s.price}</div>
            <div class="stock-change ${s.up ? 'up' : 'down'}">${s.change}</div>
          </div>
        </div>`).join('');
    }

    function renderNews(news) {
      return news.map(n => `
        <div class="news-item">
          <div class="news-tag ${n.tagClass}">${n.tag}</div>
          <div>
            <div class="news-text">${n.text}</div>
            <div class="news-time">${n.time}</div>
          </div>
        </div>`).join('');
    }

    function renderRE(re) {
      return re.map(r => `
        <div class="re-card">
          <div class="re-region">${r.region}</div>
          <div class="re-value ${r.region === 'ê±°ë˜ëŸ‰' ? 'neutral-c' : (r.up ? 'up' : 'down')}" style="font-size:${r.region==='ê±°ë˜ëŸ‰'?'13px':'15px'}">${r.value}</div>
          <div class="re-sub ${r.up ? 'up' : 'neutral-c'}">${r.sub}</div>
        </div>`).join('');
    }

    function renderAll(d) {
      const nasdaqPts = randomPoints(100, 2, 14, d.nasdaq.up ? 0.3 : -0.3);
      const sp500Pts  = randomPoints(100, 1.5, 14, d.sp500.up ? 0.3 : -0.3);
      const kospiPts  = randomPoints(100, 1.8, 14, d.kospi.up ? 0.3 : -0.3);
      const kosdaqPts = randomPoints(100, 2.2, 14, d.kosdaq.up ? 0.3 : -0.3);

      document.getElementById('usIndexRow').innerHTML =
        renderIndexCard('ë‚˜ìŠ¤ë‹¥ (QQQ)', d.nasdaq, nasdaqPts) +
        renderIndexCard('S&P 500 (SPY)', d.sp500, sp500Pts);

      document.getElementById('krIndexRow').innerHTML =
        renderIndexCard('KOSPI', d.kospi, kospiPts) +
        renderIndexCard('KOSDAQ', d.kosdaq, kosdaqPts);

      document.getElementById('fxRow').innerHTML = renderFX(d.fx);
      document.getElementById('reGrid').innerHTML = renderRE(d.re);
      document.getElementById('stockList').innerHTML = renderStocks(d.stocks);
      document.getElementById('newsList').innerHTML = renderNews(d.news);
      document.getElementById('summaryText').innerHTML = d.summary;
    }

    function setAllLastUpdated(tsText) {
      ['market','realestate','stocks','fx','settings'].forEach(k => {
        const el = document.getElementById(`lastUpdated_${k}`);
        if (el) el.textContent = tsText;
      });
    }

    // â”€â”€â”€ main load â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadMarketData(forceToast = false) {
      const icon = document.getElementById('refreshIcon');
      icon.classList.add('spin');

      try {
        if (!isLive || !API_KEY) {
          renderAll(DEMO_DATA);
          document.getElementById('apiStatusText').textContent = 'ë°ëª¨ ëª¨ë“œ';
          if (forceToast) showToast('ë°ëª¨ ëª¨ë“œë¡œ í‘œì‹œ ì¤‘', 2000);
          return;
        }

        const [nasdaq, sp500, fx] = await Promise.all([
          fetchQuote('QQQ'),
          fetchQuote('SPY'),
          fetchFX(),
        ]);

        const fmtPrice = (v) => v.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        const fmtChg = (v, up) => `${up ? '+' : ''}${v.toFixed(2)}`;

        const live = {
          ...DEMO_DATA,
          nasdaq: {
            value: '$' + fmtPrice(nasdaq.price),
            change: fmtChg(nasdaq.change, nasdaq.change > 0),
            pct: (nasdaq.change > 0 ? '+' : '') + nasdaq.pct.toFixed(2),
            up: nasdaq.change > 0
          },
          sp500: {
            value: '$' + fmtPrice(sp500.price),
            change: fmtChg(sp500.change, sp500.change > 0),
            pct: (sp500.change > 0 ? '+' : '') + sp500.pct.toFixed(2),
            up: sp500.change > 0
          },
          fx: {
            ...DEMO_DATA.fx,
            usd: Math.round(fx).toLocaleString(),
            usdChg: fx > 1340 ? `+${(fx - 1340).toFixed(0)}ì›` : `${(fx - 1340).toFixed(0)}ì›`,
            usdUp: fx < 1340,
          },
          summary: `í˜„ì¬ <strong>ë¯¸êµ­ ì§€ìˆ˜(QQQ/SPY)</strong>ì™€ <strong>USD/KRW</strong>ëŠ” ì‹¤ì‹œê°„(Alpha Vantage)ë¡œ í‘œì‹œ ì¤‘ì…ë‹ˆë‹¤.<br/>
                    êµ­ë‚´/ë¶€ë™ì‚°/ë‰´ìŠ¤/ì£¼ëª©ì¢…ëª©ì€ í˜„ì¬ ë°ëª¨ ë°ì´í„°ì´ë©°, ì›í•˜ë©´ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì‹¤ë°ì´í„°ë¡œ í™•ì¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.`
        };

        renderAll(live);
        document.getElementById('apiStatusText').textContent = 'ì •ìƒ(ì‹¤ì‹œê°„ í˜¸ì¶œ ì„±ê³µ)';

        const t = new Date();
        const stamp = `ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: ${t.getHours()}:${String(t.getMinutes()).padStart(2,'0')}:${String(t.getSeconds()).padStart(2,'0')}`;
        setAllLastUpdated(stamp);

      } catch (e) {
        console.error(e);
        renderAll(DEMO_DATA);
        document.getElementById('apiStatusText').textContent = 'ì˜¤ë¥˜/í•œë„(ë°ëª¨ í´ë°±)';
        showToast('âš ï¸ ì‹¤ì‹œê°„ API ì˜¤ë¥˜/í•œë„ ì´ˆê³¼ â†’ ë°ëª¨ë¡œ í‘œì‹œí•©ë‹ˆë‹¤', 3500);
      } finally {
        icon.classList.remove('spin');
      }
    }

    // â”€â”€â”€ auto refresh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function startAutoRefresh() {
      stopAutoRefresh();
      autoTimer = setInterval(() => {
        if (autoRefreshEnabled) loadMarketData();
      }, 5 * 60 * 1000);
    }
    function stopAutoRefresh() {
      if (autoTimer) clearInterval(autoTimer);
      autoTimer = null;
    }

    // init
    renderAll(DEMO_DATA);           // í™”ë©´ ë¼ˆëŒ€ ë¨¼ì € ì±„ì›€
    loadMarketData();              // ì‹¤ì‹œê°„ ì‹œë„
    startAutoRefresh();
    setPage('market');
  </script>
</body>
</html>
