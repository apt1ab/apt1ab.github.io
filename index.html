<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë‚˜ì˜ ì‹œí™© ë¸Œë¦¬í•‘</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0f14;
    --surface: #161b24;
    --surface2: #1e2535;
    --border: rgba(255,255,255,0.07);
    --text: #f0f2f7;
    --muted: #8b93a8;
    --up: #ff5b5b;
    --down: #4c8ef7;
    --accent: #6366f1;
    --gold: #f59e0b;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Pretendard', -apple-system, sans-serif;
    min-height: 100vh;
    padding-bottom: 80px;
  }
  .wrap { max-width: 480px; margin: 0 auto; padding: 0 16px; }

.status-bar {
background: rgba(22,27,36,0.97);
border-bottom: 1px solid var(â€“border);
padding: 10px 16px;
display: flex; align-items: center; justify-content: space-between;
position: sticky; top: 0; z-index: 200;
backdrop-filter: blur(20px);
}
.status-left { display: flex; align-items: center; gap: 8px; }
.dot { width: 7px; height: 7px; border-radius: 50%; animation: blink 2s infinite; }
.dot-green { background: #4ade80; }
.dot-yellow { background: var(â€“gold); animation-duration: 0.8s; }
.dot-red { background: var(â€“up); }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }
.status-label { font-size: 12px; font-weight: 600; color: var(â€“muted); }
.status-time { font-size: 11px; color: var(â€“muted); }
.refresh-btn {
background: none; border: 1px solid var(â€“border);
border-radius: 8px; padding: 5px 10px;
color: var(â€“muted); font-size: 11px; font-weight: 600;
cursor: pointer; display: flex; align-items: center; gap: 4px;
transition: all 0.15s;
}
.refresh-btn:hover { background: var(â€“surface2); color: var(â€“text); }
.spin { animation: spin 1s linear infinite; display: inline-block; }
@keyframes spin { to { transform: rotate(360deg); } }

header { padding: 28px 0 20px; }
.header-date { font-size: 12px; color: var(â€“muted); letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 5px; }
.header-title { font-size: 26px; font-weight: 800; letter-spacing: -0.03em; }
.header-title span { background: linear-gradient(135deg, #6366f1, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.header-sub { font-size: 13px; color: var(â€“muted); margin-top: 6px; }

.skeleton {
background: linear-gradient(90deg, var(â€“surface) 25%, var(â€“surface2) 50%, var(â€“surface) 75%);
background-size: 200% 100%;
animation: shimmer 1.5s infinite;
border-radius: 8px;
}
@keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

.summary-card {
background: linear-gradient(135deg, #1a1d35, #1e2535);
border: 1px solid rgba(99,102,241,0.25);
border-radius: 20px; padding: 18px; margin-bottom: 24px;
position: relative; overflow: hidden;
}
.summary-card::before {
content: â€˜â€™; position: absolute; top: -30px; right: -30px;
width: 100px; height: 100px;
background: radial-gradient(circle, rgba(99,102,241,0.12), transparent 70%);
pointer-events: none;
}
.summary-label {
display: flex; align-items: center; gap: 6px;
font-size: 11px; font-weight: 700; color: #818cf8;
letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 10px;
}
.ai-dot { width: 6px; height: 6px; background: #6366f1; border-radius: 50%; animation: blink 2s infinite; }
.summary-text { font-size: 13px; line-height: 1.75; color: #c7d2fe; }
.summary-text strong { color: #fff; font-weight: 600; }

.section-block { margin-bottom: 24px; }
.section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.section-title {
font-size: 12px; font-weight: 700; color: var(â€“muted);
letter-spacing: 0.06em; text-transform: uppercase;
display: flex; align-items: center; gap: 8px;
}
.section-title::before { content: â€˜â€™; width: 3px; height: 12px; background: var(â€“accent); border-radius: 2px; }
.section-note { font-size: 11px; color: var(â€“muted); }

.index-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.index-card {
background: var(â€“surface); border: 1px solid var(â€“border);
border-radius: 16px; padding: 16px; transition: all 0.2s;
}
.index-card:hover { background: var(â€“surface2); transform: translateY(-1px); }
.index-name { font-size: 11px; color: var(â€“muted); font-weight: 500; margin-bottom: 6px; }
.index-value { font-size: 19px; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 3px; }
.index-change { font-size: 12px; font-weight: 600; }
.mini-chart { margin-top: 10px; height: 30px; width: 100%; }

.up { color: var(â€“up); }
.down { color: var(â€“down); }
.neutral-c { color: var(â€“muted); }

.fx-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
.fx-card { background: var(â€“surface); border: 1px solid var(â€“border); border-radius: 14px; padding: 14px 10px; text-align: center; }
.fx-label { font-size: 10px; color: var(â€“muted); margin-bottom: 5px; font-weight: 600; letter-spacing: 0.05em; text-transform: uppercase; }
.fx-value { font-size: 15px; font-weight: 700; letter-spacing: -0.01em; margin-bottom: 3px; }
.fx-change { font-size: 11px; font-weight: 600; }

.re-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
.re-card { background: var(â€“surface); border: 1px solid var(â€“border); border-radius: 14px; padding: 14px 10px; text-align: center; }
.re-region { font-size: 11px; color: var(â€“muted); margin-bottom: 5px; }
.re-value { font-size: 14px; font-weight: 700; margin-bottom: 3px; }
.re-sub { font-size: 11px; font-weight: 500; }

.stock-list { background: var(â€“surface); border: 1px solid var(â€“border); border-radius: 20px; overflow: hidden; }
.stock-item {
display: flex; align-items: center; padding: 13px 16px;
border-bottom: 1px solid var(â€“border); transition: background 0.15s;
}
.stock-item:last-child { border-bottom: none; }
.stock-item:hover { background: var(â€“surface2); }
.stock-rank { font-size: 12px; color: var(â€“muted); font-weight: 600; width: 18px; flex-shrink: 0; }
.stock-icon {
width: 34px; height: 34px; border-radius: 10px;
display: flex; align-items: center; justify-content: center;
font-size: 12px; font-weight: 800; margin: 0 10px 0 8px; flex-shrink: 0;
}
.stock-info { flex: 1; }
.stock-name { font-size: 13px; font-weight: 600; margin-bottom: 1px; }
.stock-ticker { font-size: 11px; color: var(â€“muted); }
.stock-price-wrap { text-align: right; }
.stock-price { font-size: 14px; font-weight: 700; margin-bottom: 2px; }
.stock-change { font-size: 11px; font-weight: 600; }

.news-list { display: flex; flex-direction: column; gap: 8px; }
.news-item {
background: var(â€“surface); border: 1px solid var(â€“border);
border-radius: 14px; padding: 13px 14px;
display: flex; align-items: flex-start; gap: 10px;
}
.news-tag { font-size: 10px; font-weight: 700; padding: 3px 7px; border-radius: 20px; white-space: nowrap; flex-shrink: 0; margin-top: 1px; }
.tag-red    { background: rgba(255,91,91,0.15);  color: var(â€“up); }
.tag-blue   { background: rgba(76,142,247,0.15); color: var(â€“down); }
.tag-gold   { background: rgba(245,158,11,0.15); color: var(â€“gold); }
.tag-purple { background: rgba(99,102,241,0.15); color: #818cf8; }
.news-text { font-size: 13px; line-height: 1.5; color: #d1d5e8; }
.news-time { font-size: 11px; color: var(â€“muted); margin-top: 3px; }

.bottom-nav {
position: fixed; bottom: 0; left: 0; right: 0;
background: rgba(13,15,20,0.95); backdrop-filter: blur(20px);
border-top: 1px solid var(â€“border);
display: flex; justify-content: space-around; padding: 10px 0 18px; z-index: 100;
}
.nav-item { display: flex; flex-direction: column; align-items: center; gap: 3px; cursor: pointer; opacity: 0.45; transition: opacity 0.2s; }
.nav-item.active { opacity: 1; }
.nav-icon { font-size: 19px; }
.nav-label { font-size: 10px; font-weight: 600; }
.nav-item.active .nav-label { color: #818cf8; }

.fade-in { opacity: 0; transform: translateY(10px); animation: fadeIn 0.45s forwards; }
@keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
.fade-in:nth-child(1){animation-delay:.05s}
.fade-in:nth-child(2){animation-delay:.1s}
.fade-in:nth-child(3){animation-delay:.15s}
.fade-in:nth-child(4){animation-delay:.2s}
.fade-in:nth-child(5){animation-delay:.25s}
.fade-in:nth-child(6){animation-delay:.3s}
.fade-in:nth-child(7){animation-delay:.35s}
.fade-in:nth-child(8){animation-delay:.4s}
</style>

</head>
<body>

<div class="status-bar">
  <div class="status-left">
    <div class="dot dot-yellow" id="statusDot"></div>
    <span class="status-label" id="statusLabel">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
  </div>
  <div style="display:flex;align-items:center;gap:8px">
    <span class="status-time" id="statusTime"></span>
    <button class="refresh-btn" onclick="loadAll()">
      <span id="refreshIcon">â†»</span> ìƒˆë¡œê³ ì¹¨
    </button>
  </div>
</div>

<div class="wrap">
  <header class="fade-in">
    <div class="header-date" id="todayDate"></div>
    <h1 class="header-title">ë‚˜ì˜ <span>ì‹œí™© ë¸Œë¦¬í•‘</span></h1>
    <p class="header-sub">ì£¼ì‹ Â· í™˜ìœ¨ Â· ë¶€ë™ì‚° í•µì‹¬ë§Œ ëª¨ì•˜ì–´ìš”</p>
  </header>

  <div class="summary-card fade-in">
    <div class="summary-label"><div class="ai-dot"></div>ì˜¤ëŠ˜ì˜ ìš”ì•½</div>
    <p class="summary-text" id="summaryText">ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆì–´ìš”...</p>
  </div>

  <div class="section-block fade-in">
    <div class="section-header">
      <div class="section-title">ë¯¸êµ­ ì§€ìˆ˜</div>
      <span class="section-note" id="usNote">Yahoo Finance</span>
    </div>
    <div class="index-row" id="usIndexRow">
      <div class="index-card"><div class="index-name">ë‚˜ìŠ¤ë‹¥</div><div class="skeleton" style="height:26px;width:110px;margin-bottom:6px"></div><div class="skeleton" style="height:15px;width:130px"></div><div class="skeleton" style="height:30px;margin-top:10px"></div></div>
      <div class="index-card"><div class="index-name">S&amp;P 500</div><div class="skeleton" style="height:26px;width:110px;margin-bottom:6px"></div><div class="skeleton" style="height:15px;width:130px"></div><div class="skeleton" style="height:30px;margin-top:10px"></div></div>
    </div>
  </div>

  <div class="section-block fade-in">
    <div class="section-header">
      <div class="section-title">êµ­ë‚´ ì§€ìˆ˜</div>
      <span class="section-note">Yahoo Finance</span>
    </div>
    <div class="index-row" id="krIndexRow">
      <div class="index-card"><div class="index-name">KOSPI</div><div class="skeleton" style="height:26px;width:110px;margin-bottom:6px"></div><div class="skeleton" style="height:15px;width:130px"></div><div class="skeleton" style="height:30px;margin-top:10px"></div></div>
      <div class="index-card"><div class="index-name">KOSDAQ</div><div class="skeleton" style="height:26px;width:110px;margin-bottom:6px"></div><div class="skeleton" style="height:15px;width:130px"></div><div class="skeleton" style="height:30px;margin-top:10px"></div></div>
    </div>
  </div>

  <div class="section-block fade-in">
    <div class="section-header">
      <div class="section-title">í™˜ìœ¨ Â· ê¸ˆë¦¬</div>
    </div>
    <div class="fx-row" id="fxRow">
      <div class="fx-card"><div class="fx-label">USD/KRW</div><div class="skeleton" style="height:22px;margin:4px 0"></div><div class="skeleton" style="height:13px;width:70%;margin:0 auto"></div></div>
      <div class="fx-card"><div class="fx-label">ê¸°ì¤€ê¸ˆë¦¬</div><div class="fx-value">3.50%</div><div class="fx-change neutral-c">ë™ê²°</div></div>
      <div class="fx-card"><div class="fx-label">êµ­ê³ ì±„ 3Y</div><div class="fx-value">3.28%</div><div class="fx-change up">â–² 0.02%p</div></div>
    </div>
  </div>

  <div class="section-block fade-in">
    <div class="section-header">
      <div class="section-title">ë¶€ë™ì‚° ì‹œí™©</div>
      <span class="section-note">KB ì£¼ê°„ ê¸°ì¤€</span>
    </div>
    <div class="re-grid">
      <div class="re-card"><div class="re-region">ì„œìš¸</div><div class="re-value up">+0.02%</div><div class="re-sub neutral-c">ë§¤ë§¤ ë³´í•©</div></div>
      <div class="re-card"><div class="re-region">ê²½ê¸°</div><div class="re-value down">-0.03%</div><div class="re-sub down">ì†Œí­ í•˜ë½</div></div>
      <div class="re-card"><div class="re-region">ì¸ì²œ</div><div class="re-value down">-0.01%</div><div class="re-sub neutral-c">ë³´í•©</div></div>
      <div class="re-card"><div class="re-region">ë¶€ì‚°</div><div class="re-value up">+0.04%</div><div class="re-sub up">ì†Œí­ ìƒìŠ¹</div></div>
      <div class="re-card"><div class="re-region">ì „ì„¸</div><div class="re-value up">+0.01%</div><div class="re-sub neutral-c">ì„œìš¸ ê¸°ì¤€</div></div>
      <div class="re-card"><div class="re-region">ê±°ë˜ëŸ‰</div><div class="re-value neutral-c" style="font-size:13px">2,341ê±´</div><div class="re-sub up">ì „ì£¼æ¯” â†‘12%</div></div>
    </div>
  </div>

  <div class="section-block fade-in">
    <div class="section-header">
      <div class="section-title">ì£¼ëª© ì¢…ëª©</div>
      <span class="section-note">ì‹¤ì‹œê°„</span>
    </div>
    <div class="stock-list" id="stockList">
      <div class="stock-item"><div class="skeleton" style="width:34px;height:34px;border-radius:10px;margin:0 10px 0 18px;flex-shrink:0"></div><div style="flex:1"><div class="skeleton" style="height:14px;width:80px;margin-bottom:6px"></div><div class="skeleton" style="height:12px;width:50px"></div></div><div><div class="skeleton" style="height:14px;width:70px;margin-bottom:6px"></div><div class="skeleton" style="height:12px;width:60px"></div></div></div>
      <div class="stock-item"><div class="skeleton" style="width:34px;height:34px;border-radius:10px;margin:0 10px 0 18px;flex-shrink:0"></div><div style="flex:1"><div class="skeleton" style="height:14px;width:80px;margin-bottom:6px"></div><div class="skeleton" style="height:12px;width:50px"></div></div><div><div class="skeleton" style="height:14px;width:70px;margin-bottom:6px"></div><div class="skeleton" style="height:12px;width:60px"></div></div></div>
    </div>
  </div>

  <div class="section-block fade-in">
    <div class="section-header"><div class="section-title">ì£¼ìš” ë‰´ìŠ¤</div></div>
    <div class="news-list">
      <div class="news-item"><div class="news-tag tag-blue">ì£¼ì‹</div><div><div class="news-text">ì—°ì¤€ ìœ„ì› "ê¸ˆë¦¬ ì¸í•˜ ì„œë‘ë¥´ì§€ ì•Šê² ë‹¤"... ë‚˜ìŠ¤ë‹¥ ê¸°ìˆ ì£¼ ì¡°ì •</div><div class="news-time">ì˜¤ëŠ˜</div></div></div>
      <div class="news-item"><div class="news-tag tag-red">ë¶€ë™ì‚°</div><div><div class="news-text">ì„œìš¸ ì•„íŒŒíŠ¸ 3ì£¼ ì—°ì† ë³´í•©... ê°•ë‚¨3êµ¬ ê±°ë˜ëŸ‰ ì†Œí­ íšŒë³µ</div><div class="news-time">ì˜¤ëŠ˜</div></div></div>
      <div class="news-item"><div class="news-tag tag-gold">í™˜ìœ¨</div><div><div class="news-text">ì›Â·ë‹¬ëŸ¬ í™˜ìœ¨ 1,340ì›ëŒ€... ì™¸êµ­ì¸ ì½”ìŠ¤í”¼ ìˆœë§¤ìˆ˜ ì˜í–¥</div><div class="news-time">ì˜¤ëŠ˜</div></div></div>
      <div class="news-item"><div class="news-tag tag-purple">ë°˜ë„ì²´</div><div><div class="news-text">ì‚¼ì„±ì „ì HBM4 ì–‘ì‚° ì•ë‹¹ê²¨... í•˜ë°˜ê¸° ì‹¤ì  ê¸°ëŒ€ê° ìƒìŠ¹</div><div class="news-time">ì˜¤ëŠ˜</div></div></div>
    </div>
  </div>
</div>

<nav class="bottom-nav">
  <div class="nav-item active"><div class="nav-icon">ğŸ“Š</div><div class="nav-label">ì‹œí™©</div></div>
  <div class="nav-item"><div class="nav-icon">ğŸ </div><div class="nav-label">ë¶€ë™ì‚°</div></div>
  <div class="nav-item"><div class="nav-icon">ğŸ“ˆ</div><div class="nav-label">ì£¼ì‹</div></div>
  <div class="nav-item"><div class="nav-icon">ğŸ’±</div><div class="nav-label">í™˜ìœ¨</div></div>
  <div class="nav-item"><div class="nav-icon">âš™ï¸</div><div class="nav-label">ì„¤ì •</div></div>
</nav>

<script>
// â”€â”€ ë‚ ì§œ â”€â”€
const now = new Date();
const DAYS = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
document.getElementById('todayDate').textContent =
  `${now.getFullYear()}ë…„ ${now.getMonth()+1}ì›” ${now.getDate()}ì¼ (${DAYS[now.getDay()]})`;

// â”€â”€ Yahoo Finance í”„ë¡ì‹œ (CORS ìš°íšŒ, ë¬´ë£Œ) â”€â”€
const PROXY = 'https://query1.finance.yahoo.com/v8/finance/chart/';
const PROXY2 = 'https://query2.finance.yahoo.com/v8/finance/chart/';

const SYMBOLS = {
  nasdaq: '^IXIC',
  sp500:  '^GSPC',
  kospi:  '^KS11',
  kosdaq: '^KQ11',
  usdkrw: 'USDKRW=X',
  nvda:   'NVDA',
  aapl:   'AAPL',
  msft:   'MSFT',
  amzn:   'AMZN',
  samsung:'005930.KS',
};

const META = {
  'NVDA':     { name:'NVIDIA',      icon:'NV', color:'#f59e0b' },
  'AAPL':     { name:'Apple',       icon:'ğŸ', color:'#9ca3af' },
  'MSFT':     { name:'Microsoft',   icon:'MS', color:'#4c8ef7' },
  'AMZN':     { name:'Amazon',      icon:'Am', color:'#ff5b5b' },
  '005930.KS':{ name:'ì‚¼ì„±ì „ì',    icon:'ì‚¼', color:'#818cf8' },
};

// â”€â”€ ë°ì´í„° fetch â”€â”€
async function fetchYahoo(symbol) {
  const url = `${PROXY}${encodeURIComponent(symbol)}?interval=1d&range=1d`;
  const url2 = `${PROXY2}${encodeURIComponent(symbol)}?interval=1d&range=1d`;
  try {
    let res = await fetch(url);
    if (!res.ok) res = await fetch(url2);
    const data = await res.json();
    const meta = data?.chart?.result?.[0]?.meta;
    if (!meta) return null;
    const price = meta.regularMarketPrice;
    const prev  = meta.previousClose || meta.chartPreviousClose;
    const change = price - prev;
    const pct    = (change / prev) * 100;
    return { symbol, price, change, pct };
  } catch {
    return null;
  }
}

// â”€â”€ ë¯¸ë‹ˆ ì°¨íŠ¸ â”€â”€
function miniChart(isUp) {
  const color = isUp ? '#ff5b5b' : '#4c8ef7';
  const id = 'g' + Math.random().toString(36).substr(2,6);
  let v = 15, pts = [];
  for (let i = 0; i < 14; i++) {
    v += (Math.random() - (isUp ? 0.42 : 0.58)) * 3;
    v = Math.max(2, Math.min(28, v));
    pts.push(`${(i/13*100).toFixed(1)},${(30-v).toFixed(1)}`);
  }
  const p = pts.join(' ');
  return `<svg class="mini-chart" viewBox="0 0 100 30" preserveAspectRatio="none">
    <defs><linearGradient id="${id}" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="${color}" stop-opacity="0.18"/>
      <stop offset="100%" stop-color="${color}" stop-opacity="0"/>
    </linearGradient></defs>
    <polyline points="${p}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
    <polyline points="${p} 100,30 0,30" fill="url(#${id})" stroke="none"/>
  </svg>`;
}

// â”€â”€ í¬ë§· â”€â”€
const fmt = (n, d=2) => n?.toLocaleString('en-US', {minimumFractionDigits:d, maximumFractionDigits:d}) ?? '-';
const fmtK = (n) => n?.toLocaleString('ko-KR', {maximumFractionDigits:0}) ?? '-';
const fmtChg = (n) => n == null ? '-' : (n >= 0 ? '+' : '') + fmt(n);
const fmtPct = (n) => n == null ? '-' : (n >= 0 ? '+' : '') + n.toFixed(2) + '%';

function indexCard(name, d) {
  if (!d) return `<div class="index-card"><div class="index-name">${name}</div><div style="color:var(--muted);font-size:12px;padding:8px 0">ì ì‹œ í›„ ì¬ì‹œë„</div></div>`;
  const up = d.change >= 0;
  const isKR = d.price > 100; // ì§€ìˆ˜ êµ¬ë¶„
  const val = isKR ? fmtK(d.price) : '$' + fmt(d.price);
  return `<div class="index-card">
    <div class="index-name">${name}</div>
    <div class="index-value">${val}</div>
    <div class="index-change ${up ? 'up' : 'down'}">${up ? 'â–²' : 'â–¼'} ${fmtChg(d.change)} (${fmtPct(d.pct)})</div>
    ${miniChart(up)}
  </div>`;
}

function buildSummary(nasdaq, sp500, kospi, fx) {
  const nd = nasdaq ? `<strong class="${nasdaq.pct>=0?'up':'down'}">${nasdaq.pct>=0?'â–²':'â–¼'} ${Math.abs(nasdaq.pct).toFixed(2)}% ${nasdaq.pct>=0?'ìƒìŠ¹':'í•˜ë½'}</strong>` : '<strong>ì§‘ê³„ ì¤‘</strong>';
  const sp = sp500  ? `<strong class="${sp500.pct>=0?'up':'down'}">${sp500.pct>=0?'â–²':'â–¼'} ${Math.abs(sp500.pct).toFixed(2)}% ${sp500.pct>=0?'ìƒìŠ¹':'í•˜ë½'}</strong>` : '<strong>ì§‘ê³„ ì¤‘</strong>';
  const ks = kospi  ? `<strong>${fmtK(kospi.price)}p</strong>` : '<strong>ì§‘ê³„ ì¤‘</strong>';
  const usd = fx    ? `<strong>${Math.round(fx.price).toLocaleString()}ì›</strong>` : '<strong>ì§‘ê³„ ì¤‘</strong>';
  return `ë‚˜ìŠ¤ë‹¥ì´ ${nd}í–ˆì–´ìš”. S&P 500ì€ ${sp} ë§ˆê°í–ˆìŠµë‹ˆë‹¤. ì½”ìŠ¤í”¼ëŠ” ${ks}ë¡œ ê±°ë˜ ì¤‘ì´ì—ìš”. ì›Â·ë‹¬ëŸ¬ í™˜ìœ¨ì€ ${usd}ì„ ê¸°ë¡í•˜ê³  ìˆì–´ìš”.`;
}

// â”€â”€ ë©”ì¸ ë¡œë“œ â”€â”€
async function loadAll() {
  const icon  = document.getElementById('refreshIcon');
  const dot   = document.getElementById('statusDot');
  const label = document.getElementById('statusLabel');
  icon.innerHTML = '<span class="spin">â†»</span>';
  dot.className = 'dot dot-yellow';
  label.textContent = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';

  try {
    // ëª¨ë“  ì¢…ëª© ë™ì‹œì— ê°€ì ¸ì˜¤ê¸°
    const [nasdaq, sp500, kospi, kosdaq, usdkrw, nvda, aapl, msft, amzn, samsung] = await Promise.all([
      fetchYahoo(SYMBOLS.nasdaq),
      fetchYahoo(SYMBOLS.sp500),
      fetchYahoo(SYMBOLS.kospi),
      fetchYahoo(SYMBOLS.kosdaq),
      fetchYahoo(SYMBOLS.usdkrw),
      fetchYahoo(SYMBOLS.nvda),
      fetchYahoo(SYMBOLS.aapl),
      fetchYahoo(SYMBOLS.msft),
      fetchYahoo(SYMBOLS.amzn),
      fetchYahoo(SYMBOLS.samsung),
    ]);

    // ë¯¸êµ­ ì§€ìˆ˜
    document.getElementById('usIndexRow').innerHTML =
      indexCard('ë‚˜ìŠ¤ë‹¥ (IXIC)', nasdaq) +
      indexCard('S&amp;P 500', sp500);

    // êµ­ë‚´ ì§€ìˆ˜
    document.getElementById('krIndexRow').innerHTML =
      indexCard('KOSPI', kospi) +
      indexCard('KOSDAQ', kosdaq);

    // í™˜ìœ¨
    if (usdkrw) {
      const diff = usdkrw.change;
      document.getElementById('fxRow').innerHTML = `
        <div class="fx-card">
          <div class="fx-label">USD/KRW</div>
          <div class="fx-value">${Math.round(usdkrw.price).toLocaleString()}</div>
          <div class="fx-change ${diff >= 0 ? 'up' : 'down'}">${diff >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(diff).toFixed(1)}ì›</div>
        </div>
        <div class="fx-card">
          <div class="fx-label">ê¸°ì¤€ê¸ˆë¦¬</div>
          <div class="fx-value">3.50%</div>
          <div class="fx-change neutral-c">ë™ê²°</div>
        </div>
        <div class="fx-card">
          <div class="fx-label">êµ­ê³ ì±„ 3Y</div>
          <div class="fx-value">3.28%</div>
          <div class="fx-change up">â–² 0.02%p</div>
        </div>`;
    }

    // ì¢…ëª©
    const stocks = [samsung, nvda, aapl, msft, amzn].filter(Boolean);
    if (stocks.length) {
      document.getElementById('stockList').innerHTML = stocks.map((s, i) => {
        const m = META[s.symbol] || { name: s.symbol, icon: s.symbol.substr(0,2), color: '#6366f1' };
        const up = s.change >= 0;
        const isKR = s.symbol.includes('.KS');
        const priceStr = isKR ? fmtK(s.price) + 'ì›' : '$' + fmt(s.price);
        return `<div class="stock-item">
          <div class="stock-rank">${i+1}</div>
          <div class="stock-icon" style="background:${m.color}22;color:${m.color}">${m.icon}</div>
          <div class="stock-info">
            <div class="stock-name">${m.name}</div>
            <div class="stock-ticker">${s.symbol.replace('.KS','')}</div>
          </div>
          <div class="stock-price-wrap">
            <div class="stock-price">${priceStr}</div>
            <div class="stock-change ${up ? 'up' : 'down'}">${fmtChg(s.change)} (${fmtPct(s.pct)})</div>
          </div>
        </div>`;
      }).join('');
    }

    // ìš”ì•½
    document.getElementById('summaryText').innerHTML = buildSummary(nasdaq, sp500, kospi, usdkrw);

    // ìƒíƒœ
    dot.className = 'dot dot-green';
    label.textContent = 'ì‹¤ì‹œê°„ Â· Yahoo Finance';
    const t = new Date();
    document.getElementById('statusTime').textContent =
      `${t.getHours()}:${String(t.getMinutes()).padStart(2,'0')} ì—…ë°ì´íŠ¸`;

  } catch(err) {
    dot.className = 'dot dot-red';
    label.textContent = 'ì—°ê²° ì‹¤íŒ¨ Â· ì¬ì‹œë„ ì¤‘...';
    setTimeout(loadAll, 5000);
  }

  icon.innerHTML = 'â†»';
}

loadAll();
setInterval(loadAll, 10 * 60 * 1000); // 10ë¶„ë§ˆë‹¤ ìë™ê°±ì‹ 
</script>

</body>
</html>
